# Example for a typesetsourcefiles variable in l3build

This is an example use case for [a typesetsourcefiles variable for l3build.lua](https://github.com/latex3/latex3/pull/358). In this project, there is [a test in the directory `testfile`](testfiles/test.lvt) which completes successfully. When building the documentation, a fictional test in `*.lvt` format is also unpacked. It is first compiled and then included in the documentation.

[The first commit in this repository](https://github.com/dffischer/typesetsourcefiles-example/tree/49cc3ed9c7e31a07beba8d53a4a095cea570036d) shows the intuitive approach: `sourcefiles` is left to its default of `*.dtx` and `*.ins`, so when `texlua l3build.lua doc` is run, the documentation source and its test are unpacked, the test compiled first as a `typesetdemofile`. Then, the documentation is compiled using it. However, running `check` will fail: In addition to the intended test from the `testfile` directory, the "fake" test only used in the documentation is also attempted to run. No corresponding `*.lvg`, `*.lve` or `*.pdf` can be found and thus, testing fails.

After [the second commit](https://github.com/dffischer/typesetsourcefiles-example/tree/065fe02226e0bf0655bd297a13d48b78d95ab3e2), building only works with [the corresponding changes](https://github.com/latex3/latex3/pull/358) applied to l3build. It shows how `typesetsourcefiles` solves the issue: The contents only used when building the documentation are only unpacked before it is typeset. They do not interfere with `check`, which now yield the correct answer that all tests passed.
